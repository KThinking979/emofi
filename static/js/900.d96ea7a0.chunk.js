"use strict";(self.webpackChunkemojifi=self.webpackChunkemojifi||[]).push([[900],{407:(e,t,n)=>{n.d(t,{T:()=>d});var i=n(24448),r=n(76979),s=n(97681),o=n(58039),a=n(26306),u=n(44414),d=(0,o.R)((function(e,t){const n=(0,r.uo)(e),o=(0,i.e)();return(0,u.jsx)(a.B.div,{...n,width:"100%",ref:t,className:(0,s.cx)("chakra-tabs__tab-panels",e.className),__css:o.tabpanels})}));d.displayName="TabPanels"},34571:(e,t,n)=>{n.d(t,{w:()=>d});var i=n(24448),r=n(76979),s=n(97681),o=n(58039),a=n(26306),u=n(44414),d=(0,o.R)((function(e,t){const n=(0,r.$c)({...e,ref:t}),o={display:"flex",...(0,i.e)().tablist};return(0,u.jsx)(a.B.div,{...n,className:(0,s.cx)("chakra-tabs__tablist",e.className),__css:o})}));d.displayName="TabList"},24448:(e,t,n)=>{n.d(t,{e:()=>p,t:()=>m});var i=n(76979),r=n(80221),s=n(58039),o=n(66296),a=n(82867),u=n(26306),d=n(97681),c=n(9950),l=n(44414),[h,p]=(0,r.q)({name:"TabsStylesContext",errorMessage:"useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<Tabs />\" "}),m=(0,s.R)((function(e,t){const n=(0,o.o5)("Tabs",e),{children:r,className:s,...p}=(0,a.MN)(e),{htmlProps:m,descendants:g,...f}=(0,i.uc)(p),v=(0,c.useMemo)((()=>f),[f]),{isFitted:_,...y}=m,b={position:"relative",...n.root};return(0,l.jsx)(i.at,{value:g,children:(0,l.jsx)(i.O_,{value:v,children:(0,l.jsx)(h,{value:n,children:(0,l.jsx)(u.B.div,{className:(0,d.cx)("chakra-tabs",s),ref:t,...y,__css:b,children:r})})})})}));m.displayName="Tabs"},1784:(e,t,n)=>{n.d(t,{o:()=>d});var i=n(24448),r=n(76979),s=n(97681),o=n(58039),a=n(26306),u=n(44414),d=(0,o.R)((function(e,t){const n=(0,i.e)(),o=(0,r.Vh)({...e,ref:t}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...n.tab};return(0,u.jsx)(a.B.button,{...o,className:(0,s.cx)("chakra-tabs__tab",e.className),__css:d})}));d.displayName="Tab"},34881:(e,t,n)=>{n.d(t,{K:()=>d});var i=n(24448),r=n(76979),s=n(97681),o=n(58039),a=n(26306),u=n(44414),d=(0,o.R)((function(e,t){const n=(0,r.Jn)({...e,ref:t}),o=(0,i.e)();return(0,u.jsx)(a.B.div,{outline:"0",...n,className:(0,s.cx)("chakra-tabs__tab-panel",e.className),__css:o.tabpanel})}));d.displayName="TabPanel"},76979:(e,t,n)=>{n.d(t,{at:()=>C,O_:()=>A,Vh:()=>F,$c:()=>S,Jn:()=>E,uo:()=>x,uc:()=>I});var i=n(9950);var r=n(97681),s=n(87237);function o(e){const t=e.target,{tagName:n,isContentEditable:i}=t;return"INPUT"!==n&&"TEXTAREA"!==n&&!0!==i}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{ref:t,isDisabled:n,isFocusable:a,clickOnEnter:u=!0,clickOnSpace:d=!0,onMouseDown:c,onMouseUp:l,onClick:h,onKeyDown:p,onKeyUp:m,tabIndex:g,onMouseOver:f,onMouseLeave:v,..._}=e,[y,b]=(0,i.useState)(!0),[C,w]=(0,i.useState)(!1),M=function(){const e=(0,i.useRef)(new Map),t=e.current,n=(0,i.useCallback)(((t,n,i,r)=>{e.current.set(i,{type:n,el:t,options:r}),t.addEventListener(n,i,r)}),[]),r=(0,i.useCallback)(((t,n,i,r)=>{t.removeEventListener(n,i,r),e.current.delete(i)}),[]);return(0,i.useEffect)((()=>()=>{t.forEach(((e,t)=>{r(e.el,e.type,t,e.options)}))}),[r,t]),{add:n,remove:r}}(),k=y?g:g||0,I=n&&!a,A=(0,i.useCallback)((e=>{if(n)return e.stopPropagation(),void e.preventDefault();e.currentTarget.focus(),null==h||h(e)}),[n,h]),T=(0,i.useCallback)((e=>{C&&o(e)&&(e.preventDefault(),e.stopPropagation(),w(!1),M.remove(document,"keyup",T,!1))}),[C,M]),S=(0,i.useCallback)((e=>{if(null==p||p(e),n||e.defaultPrevented||e.metaKey)return;if(!o(e.nativeEvent)||y)return;const t=u&&"Enter"===e.key;if(d&&" "===e.key&&(e.preventDefault(),w(!0)),t){e.preventDefault();e.currentTarget.click()}M.add(document,"keyup",T,!1)}),[n,y,p,u,d,M,T]),F=(0,i.useCallback)((e=>{if(null==m||m(e),n||e.defaultPrevented||e.metaKey)return;if(!o(e.nativeEvent)||y)return;if(d&&" "===e.key){e.preventDefault(),w(!1);e.currentTarget.click()}}),[d,y,n,m]),P=(0,i.useCallback)((e=>{0===e.button&&(w(!1),M.remove(document,"mouseup",P,!1))}),[M]),j=(0,i.useCallback)((e=>{if(0!==e.button)return;if(n)return e.stopPropagation(),void e.preventDefault();y||w(!0);e.currentTarget.focus({preventScroll:!0}),M.add(document,"mouseup",P,!1),null==c||c(e)}),[n,y,c,M,P]),x=(0,i.useCallback)((e=>{0===e.button&&(y||w(!1),null==l||l(e))}),[l,y]),E=(0,i.useCallback)((e=>{n?e.preventDefault():null==f||f(e)}),[n,f]),R=(0,i.useCallback)((e=>{C&&(e.preventDefault(),w(!1)),null==v||v(e)}),[C,v]),L=(0,s.Px)(t,(e=>{e&&"BUTTON"!==e.tagName&&b(!1)}));return y?{..._,ref:L,type:"button","aria-disabled":I?void 0:n,disabled:I,onClick:A,onMouseDown:c,onMouseUp:l,onKeyUp:m,onKeyDown:p,onMouseOver:f,onMouseLeave:v}:{..._,ref:L,role:"button","data-active":(0,r.sE)(C),"aria-disabled":n?"true":void 0,tabIndex:I?void 0:k,onClick:A,onMouseDown:j,onMouseUp:x,onKeyUp:F,onKeyDown:S,onMouseOver:E,onMouseLeave:R}}var u=Object.defineProperty,d=(e,t,n)=>(((e,t,n)=>{t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);function c(e){return e.sort(((e,t)=>{const n=e.compareDocumentPosition(t);if(n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(n&Node.DOCUMENT_POSITION_DISCONNECTED||n&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0}))}function l(e,t,n){let i=e+1;return n&&i>=t&&(i=0),i}function h(e,t,n){let i=e-1;return n&&i<0&&(i=t),i}var p="undefined"!==typeof window?i.useLayoutEffect:i.useEffect,m=e=>e,g=class{constructor(){var e=this;d(this,"descendants",new Map),d(this,"register",(e=>{var t;if(null!=e)return"object"==typeof(t=e)&&"nodeType"in t&&t.nodeType===Node.ELEMENT_NODE?this.registerNode(e):t=>{this.registerNode(t,e)}})),d(this,"unregister",(e=>{this.descendants.delete(e);const t=c(Array.from(this.descendants.keys()));this.assignIndex(t)})),d(this,"destroy",(()=>{this.descendants.clear()})),d(this,"assignIndex",(e=>{this.descendants.forEach((t=>{const n=e.indexOf(t.node);t.index=n,t.node.dataset.index=t.index.toString()}))})),d(this,"count",(()=>this.descendants.size)),d(this,"enabledCount",(()=>this.enabledValues().length)),d(this,"values",(()=>Array.from(this.descendants.values()).sort(((e,t)=>e.index-t.index)))),d(this,"enabledValues",(()=>this.values().filter((e=>!e.disabled)))),d(this,"item",(e=>{if(0!==this.count())return this.values()[e]})),d(this,"enabledItem",(e=>{if(0!==this.enabledCount())return this.enabledValues()[e]})),d(this,"first",(()=>this.item(0))),d(this,"firstEnabled",(()=>this.enabledItem(0))),d(this,"last",(()=>this.item(this.descendants.size-1))),d(this,"lastEnabled",(()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)})),d(this,"indexOf",(e=>{var t,n;return e&&null!=(n=null==(t=this.descendants.get(e))?void 0:t.index)?n:-1})),d(this,"enabledIndexOf",(e=>null==e?-1:this.enabledValues().findIndex((t=>t.node.isSameNode(e))))),d(this,"next",(function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=l(t,e.count(),n);return e.item(i)})),d(this,"nextEnabled",(function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=e.item(t);if(!i)return;const r=l(e.enabledIndexOf(i.node),e.enabledCount(),n);return e.enabledItem(r)})),d(this,"prev",(function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=h(t,e.count()-1,n);return e.item(i)})),d(this,"prevEnabled",(function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=e.item(t);if(!i)return;const r=h(e.enabledIndexOf(i.node),e.enabledCount()-1,n);return e.enabledItem(r)})),d(this,"registerNode",((e,t)=>{if(!e||this.descendants.has(e))return;const n=c(Array.from(this.descendants.keys()).concat(e));(null==t?void 0:t.disabled)&&(t.disabled=!!t.disabled);const i={node:e,index:-1,...t};this.descendants.set(e,i),this.assignIndex(n)}))}},f=n(80221);var[v,_]=(0,f.q)({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});var y=n(91823);var b=n(68253);var[C,w,M,k]=[m(v),()=>m(_()),()=>function(){const e=(0,i.useRef)(new g);return p((()=>()=>e.current.destroy())),e.current}(),e=>function(e){const t=_(),[n,r]=(0,i.useState)(-1),o=(0,i.useRef)(null);p((()=>()=>{o.current&&t.unregister(o.current)}),[]),p((()=>{if(!o.current)return;const e=Number(o.current.dataset.index);n==e||Number.isNaN(e)||r(e)}));const a=m(e?t.register(e):t.register);return{descendants:t,index:n,enabledIndex:t.enabledIndexOf(o.current),register:(0,s.Px)(a,o)}}(e)];function I(e){var t;const{defaultIndex:n,onChange:r,index:s,isManual:o,isLazy:a,lazyBehavior:u="unmount",orientation:d="horizontal",direction:c="ltr",...l}=e,[h,p]=(0,i.useState)(null!=n?n:0),[m,g]=function(e){const{value:t,defaultValue:n,onChange:r,shouldUpdate:s=(e,t)=>e!==t}=e,o=(0,y.c)(r),a=(0,y.c)(s),[u,d]=(0,i.useState)(n),c=void 0!==t,l=c?t:u,h=(0,y.c)((e=>{const t="function"===typeof e?e(l):e;a(l,t)&&(c||d(t),o(t))}),[c,o,l,a]);return[l,h]}({defaultValue:null!=n?n:0,value:s,onChange:r});(0,i.useEffect)((()=>{null!=s&&p(s)}),[s]);const f=M(),v=(0,i.useId)(),_=null!=(t=e.id)?t:v;return{id:"tabs-".concat(_),selectedIndex:m,focusedIndex:h,setSelectedIndex:g,setFocusedIndex:p,isManual:o,isLazy:a,lazyBehavior:u,orientation:d,descendants:f,direction:c,htmlProps:l}}var[A,T]=(0,f.q)({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function S(e){const{focusedIndex:t,orientation:n,direction:s}=T(),o=w(),a=(0,i.useCallback)((e=>{const i=()=>{var e;const n=o.nextEnabled(t);n&&(null==(e=n.node)||e.focus())},r=()=>{var e;const n=o.prevEnabled(t);n&&(null==(e=n.node)||e.focus())},a="horizontal"===n,u="vertical"===n,d=e.key,c="ltr"===s?"ArrowLeft":"ArrowRight",l="ltr"===s?"ArrowRight":"ArrowLeft",h={[c]:()=>a&&r(),[l]:()=>a&&i(),ArrowDown:()=>u&&i(),ArrowUp:()=>u&&r(),Home:()=>{var e;const t=o.firstEnabled();t&&(null==(e=t.node)||e.focus())},End:()=>{var e;const t=o.lastEnabled();t&&(null==(e=t.node)||e.focus())}}[d];h&&(e.preventDefault(),h(e))}),[o,t,n,s]);return{...e,role:"tablist","aria-orientation":n,onKeyDown:(0,r.Hj)(e.onKeyDown,a)}}function F(e){const{isDisabled:t=!1,isFocusable:n=!1,...i}=e,{setSelectedIndex:o,isManual:u,id:d,setFocusedIndex:c,selectedIndex:l}=T(),{index:h,register:p}=k({disabled:t&&!n}),m=h===l;return{...a({...i,ref:(0,s.Px)(p,e.ref),isDisabled:t,isFocusable:n,onClick:(0,r.Hj)(e.onClick,(()=>{o(h)}))}),id:R(d,h),role:"tab",tabIndex:m?0:-1,type:"button","aria-selected":m,"aria-controls":L(d,h),onFocus:t?void 0:(0,r.Hj)(e.onFocus,(()=>{c(h);!u&&!(t&&n)&&o(h)}))}}var[P,j]=(0,f.q)({});function x(e){const t=T(),{id:n,selectedIndex:r}=t,s=(0,b.a)(e.children).map(((e,t)=>(0,i.createElement)(P,{key:t,value:{isSelected:t===r,id:L(n,t),tabId:R(n,t),selectedIndex:r}},e)));return{...e,children:s}}function E(e){const{children:t,...n}=e,{isLazy:r,lazyBehavior:s}=T(),{isSelected:o,id:a,tabId:u}=j(),d=(0,i.useRef)(!1);o&&(d.current=!0);const c=function(e){const{wasSelected:t,enabled:n,isSelected:i,mode:r="unmount"}=e;return!n||!!i||!("keepMounted"!==r||!t)}({wasSelected:d.current,isSelected:o,enabled:r,mode:s});return{tabIndex:0,...n,children:c?t:null,role:"tabpanel","aria-labelledby":u,hidden:!o,id:a}}function R(e,t){return"".concat(e,"--tab-").concat(t)}function L(e,t){return"".concat(e,"--tabpanel-").concat(t)}},42691:(e,t,n)=>{n.d(t,{cC:()=>Xe});var i=n(64467);const r=new Map;function s(e){var t;const n=Array.isArray(e)?e:[e],i=n.join(","),s=null!==(t=r.get(i))&&void 0!==t?t:(()=>{const e=function(e){const t=e.flatMap((e=>function(e,t){if(0===t.length)throw new Error("Empty filter query given");const n=t.map(u).filter((e=>!0!==e));if(0===n.length)return t;throw 1===n.length?new Error(n[0]):new Error("Invalid filter query '".concat(e.join(":"),"'. There are ").concat(n.length," errors after expanding the contained shortcuts: ").concat(n.join("; ")))}(e,a(e)))),n=function(e){const t=Object.entries(e).map((e=>{let[t,n]=e;const i=e=>e[t],r=Object.entries(n).map((e=>{let[t,n]=e;const i=e=>e[t],r=Array.from(n).map((e=>"me"===e?(e,t)=>{const n=t.me.id;return h(e,(e=>e.id===n))}:t=>h(t,(t=>t[e]||t.type===e))));return 0===r.length?l(i):c(i,r.reduce(d))}));return 0===r.length?l(i):c(i,r.reduce(d))}));if(0===t.length)throw new Error("Cannot create filter function for empty query");return t.reduce(d)}(function(e){const t={};for(const[r,s,o]of e){var n;const e=null!==(n=t[r])&&void 0!==n?n:t[r]={};if(void 0!==s){var i;const t=null!==(i=e[s])&&void 0!==i?i:e[s]=new Set;void 0!==o&&t.add(o)}}return t}(t));return e=>!!n(e.update,e)}(o(n));return r.set(i,e),e})();return e=>s(e)}function o(e){return Array.isArray(e)?e.map((e=>e.split(":"))):[e.split(":")]}function a(e){const t=b,n=[e].flatMap((e=>{const[n,i,r]=e;if(!(n in C))return[e];if(!n&&!i&&!r)return[e];const s=C[n].map((e=>[e,i,r]));return void 0===i||i in w&&(i||r)?s:s.filter((e=>{var n;let[r]=e;return!(null===(n=t[r])||void 0===n||!n[i])}))})).flatMap((e=>{const[n,i,r]=e;if(!(i in w))return[e];if(!i&&!r)return[e];const s=w[i].map((e=>[n,e,r]));return void 0===r?s:s.filter((e=>{var i;let[,s]=e;return!(null===(i=t[n])||void 0===i||null===(i=i[s])||void 0===i||!i[r])}))}));if(0===n.length)throw new Error("Shortcuts in '".concat(e.join(":"),"' do not expand to any valid filter query"));return n}function u(e){const[t,n,i,...r]=e;if(void 0===t)return"Empty filter query given";if(!(t in b)){const n=Object.keys(b);return"Invalid L1 filter '".concat(t,"' given in '").concat(e.join(":"),"'. Permitted values are: ").concat(n.map((e=>"'".concat(e,"'"))).join(", "),".")}if(void 0===n)return!0;const s=b[t];if(!(n in s)){const t=Object.keys(s);return"Invalid L2 filter '".concat(n,"' given in '").concat(e.join(":"),"'. Permitted values are: ").concat(t.map((e=>"'".concat(e,"'"))).join(", "),".")}if(void 0===i)return!0;const o=s[n];if(!(i in o)){const r=Object.keys(o);return"Invalid L3 filter '".concat(i,"' given in '").concat(e.join(":"),"'. ").concat(0===r.length?"No further filtering is possible after '".concat(t,":").concat(n,"'."):"Permitted values are: ".concat(r.map((e=>"'".concat(e,"'"))).join(", "),"."))}return 0===r.length||"Cannot filter further than three levels, ':".concat(r.join(":"),"' is invalid!")}function d(e,t){return(n,i)=>e(n,i)||t(n,i)}function c(e,t){return(n,i)=>{const r=e(n,i);return r&&t(r,i)}}function l(e){return(t,n)=>null!=e(t,n)}function h(e,t){const n=e=>null!=e&&t(e);return Array.isArray(e)?e.some(n):n(e)}const p={mention:{},hashtag:{},cashtag:{},bot_command:{},url:{},email:{},phone_number:{},bold:{},italic:{},underline:{},strikethrough:{},spoiler:{},blockquote:{},expandable_blockquote:{},code:{},pre:{},text_link:{},text_mention:{},custom_emoji:{}},m={me:{},is_bot:{},is_premium:{},added_to_attachment_menu:{}},g={emoji:{},custom_emoji:{}},f={forward_origin:{user:{},hidden_user:{},chat:{},channel:{}},is_topic_message:{},is_automatic_forward:{},business_connection_id:{},text:{},animation:{},audio:{},document:{},photo:{},sticker:{is_video:{},is_animated:{},premium_animation:{}},story:{},video:{},video_note:{},voice:{},contact:{},dice:{},game:{},poll:{},venue:{},location:{},paid_media:{},entities:p,caption_entities:p,caption:{},effect_id:{},has_media_spoiler:{},new_chat_title:{},new_chat_photo:{},delete_chat_photo:{},message_auto_delete_timer_changed:{},pinned_message:{},chat_background_set:{},invoice:{},proximity_alert_triggered:{},video_chat_scheduled:{},video_chat_started:{},video_chat_ended:{},video_chat_participants_invited:{},web_app_data:{}},v={...f,sender_boost_count:{},new_chat_members:m,left_chat_member:m,group_chat_created:{},supergroup_chat_created:{},migrate_to_chat_id:{},migrate_from_chat_id:{},successful_payment:{},refunded_payment:{},boost_added:{},users_shared:{},chat_shared:{},connected_website:{},write_access_allowed:{},passport_data:{},forum_topic_created:{},forum_topic_edited:{name:{},icon_custom_emoji_id:{}},forum_topic_closed:{},forum_topic_reopened:{},general_forum_topic_hidden:{},general_forum_topic_unhidden:{}},_={...f,channel_chat_created:{}},y={from:m},b={message:v,edited_message:v,channel_post:_,edited_channel_post:_,business_connection:{can_reply:{},is_enabled:{}},business_message:v,edited_business_message:v,deleted_business_messages:{},inline_query:{},chosen_inline_result:{},callback_query:{data:{},game_short_name:{}},shipping_query:{},pre_checkout_query:{},poll:{},poll_answer:{},my_chat_member:y,chat_member:y,chat_join_request:{},message_reaction:{old_reaction:g,new_reaction:g},message_reaction_count:{reactions:g},chat_boost:{},removed_chat_boost:{}},C={"":["message","channel_post"],msg:["message","channel_post"],edit:["edited_message","edited_channel_post"]},w={"":["entities","caption_entities"],media:["photo","video"],file:["photo","animation","audio","document","video","video_note","voice","sticker"]},M={filterQuery(e){const t=s(e);return e=>t(e)},text(e){const t=M.filterQuery([":text",":caption"]),n=A(e);return e=>{var i,r;if(!t(e))return!1;const s=null!==(i=e.message)&&void 0!==i?i:e.channelPost;return T(e,null!==(r=s.text)&&void 0!==r?r:s.caption,n)}},command(e){const t=M.filterQuery(":entities:bot_command"),n=new Set,i=new Set;return S(e).forEach((e=>{if(e.startsWith("/"))throw new Error("Do not include '/' when registering command handlers (use '".concat(e.substring(1),"' not '").concat(e,"')"));(e.includes("@")?n:i).add(e)})),e=>{var r,s;if(!t(e))return!1;const o=null!==(r=e.message)&&void 0!==r?r:e.channelPost,a=null!==(s=o.text)&&void 0!==s?s:o.caption;return o.entities.some((t=>{if("bot_command"!==t.type)return!1;if(0!==t.offset)return!1;const r=a.substring(1,t.length);if(i.has(r)||n.has(r))return e.match=a.substring(r.length+1).trimStart(),!0;const s=r.indexOf("@");if(-1===s)return!1;if(r.substring(s+1).toLowerCase()!==e.me.username.toLowerCase())return!1;const o=r.substring(0,s);return!!i.has(o)&&(e.match=a.substring(r.length+1).trimStart(),!0)}))}},reaction(e){const t=M.filterQuery("message_reaction"),n="string"===typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"===typeof e?{type:"emoji",emoji:e}:e));return e=>{if(!t(e))return!1;const{old_reaction:i,new_reaction:r}=e.messageReaction;for(const t of r){let e=!1;if("emoji"===t.type){for(const n of i)if("emoji"===n.type&&n.emoji===t.emoji){e=!0;break}}else if("custom_emoji"===t.type)for(const n of i)if("custom_emoji"===n.type&&n.custom_emoji_id===t.custom_emoji_id){e=!0;break}if(!e)if("emoji"===t.type){for(const i of n)if("emoji"===i.type&&i.emoji===t.emoji)return!0}else{if("custom_emoji"!==t.type)return!0;for(const e of n)if("custom_emoji"===e.type&&e.custom_emoji_id===t.custom_emoji_id)return!0}}return!1}},chatType(e){const t=new Set(S(e));return e=>{var n;return void 0!==(null===(n=e.chat)||void 0===n?void 0:n.type)&&t.has(e.chat.type)}},callbackQuery(e){const t=M.filterQuery("callback_query:data"),n=A(e);return e=>t(e)&&T(e,e.callbackQuery.data,n)},gameQuery(e){const t=M.filterQuery("callback_query:game_short_name"),n=A(e);return e=>t(e)&&T(e,e.callbackQuery.game_short_name,n)},inlineQuery(e){const t=M.filterQuery("inline_query"),n=A(e);return e=>t(e)&&T(e,e.inlineQuery.query,n)},chosenInlineResult(e){const t=M.filterQuery("chosen_inline_result"),n=A(e);return e=>t(e)&&T(e,e.chosenInlineResult.result_id,n)},preCheckoutQuery(e){const t=M.filterQuery("pre_checkout_query"),n=A(e);return e=>t(e)&&T(e,e.preCheckoutQuery.invoice_payload,n)},shippingQuery(e){const t=M.filterQuery("shipping_query"),n=A(e);return e=>t(e)&&T(e,e.shippingQuery.invoice_payload,n)}};class k{constructor(e,t,n){(0,i.A)(this,"update",void 0),(0,i.A)(this,"api",void 0),(0,i.A)(this,"me",void 0),(0,i.A)(this,"match",void 0),this.update=e,this.api=t,this.me=n}get message(){return this.update.message}get editedMessage(){return this.update.edited_message}get channelPost(){return this.update.channel_post}get editedChannelPost(){return this.update.edited_channel_post}get businessConnection(){return this.update.business_connection}get businessMessage(){return this.update.business_message}get editedBusinessMessage(){return this.update.edited_business_message}get deletedBusinessMessages(){return this.update.deleted_business_messages}get messageReaction(){return this.update.message_reaction}get messageReactionCount(){return this.update.message_reaction_count}get inlineQuery(){return this.update.inline_query}get chosenInlineResult(){return this.update.chosen_inline_result}get callbackQuery(){return this.update.callback_query}get shippingQuery(){return this.update.shipping_query}get preCheckoutQuery(){return this.update.pre_checkout_query}get poll(){return this.update.poll}get pollAnswer(){return this.update.poll_answer}get myChatMember(){return this.update.my_chat_member}get chatMember(){return this.update.chat_member}get chatJoinRequest(){return this.update.chat_join_request}get chatBoost(){return this.update.chat_boost}get removedChatBoost(){return this.update.removed_chat_boost}get msg(){var e,t,n,i,r,s,o;return null!==(e=null!==(t=null!==(n=null!==(i=null!==(r=null!==(s=this.message)&&void 0!==s?s:this.editedMessage)&&void 0!==r?r:this.channelPost)&&void 0!==i?i:this.editedChannelPost)&&void 0!==n?n:this.businessMessage)&&void 0!==t?t:this.editedBusinessMessage)&&void 0!==e?e:null===(o=this.callbackQuery)||void 0===o?void 0:o.message}get chat(){var e,t,n,i,r,s,o,a,u;return null===(e=null!==(t=null!==(n=null!==(i=null!==(r=null!==(s=null!==(o=null!==(a=null!==(u=this.msg)&&void 0!==u?u:this.deletedBusinessMessages)&&void 0!==a?a:this.messageReaction)&&void 0!==o?o:this.messageReactionCount)&&void 0!==s?s:this.myChatMember)&&void 0!==r?r:this.chatMember)&&void 0!==i?i:this.chatJoinRequest)&&void 0!==n?n:this.chatBoost)&&void 0!==t?t:this.removedChatBoost)||void 0===e?void 0:e.chat}get senderChat(){var e;return null===(e=this.msg)||void 0===e?void 0:e.sender_chat}get from(){var e,t,n,i,r,s,o,a,u,d,c,l,h,p,m,g;return null!==(e=null===(t=null!==(n=null!==(i=this.businessConnection)&&void 0!==i?i:this.messageReaction)&&void 0!==n?n:null===(r=null!==(s=null===(o=this.chatBoost)||void 0===o?void 0:o.boost)&&void 0!==s?s:this.removedChatBoost)||void 0===r?void 0:r.source)||void 0===t?void 0:t.user)&&void 0!==e?e:null===(a=null!==(u=null!==(d=null!==(c=null!==(l=null!==(h=null!==(p=null!==(m=null!==(g=this.callbackQuery)&&void 0!==g?g:this.msg)&&void 0!==m?m:this.inlineQuery)&&void 0!==p?p:this.chosenInlineResult)&&void 0!==h?h:this.shippingQuery)&&void 0!==l?l:this.preCheckoutQuery)&&void 0!==c?c:this.myChatMember)&&void 0!==d?d:this.chatMember)&&void 0!==u?u:this.chatJoinRequest)||void 0===a?void 0:a.from}get msgId(){var e,t,n,i,r;return null!==(e=null!==(t=null===(n=this.msg)||void 0===n?void 0:n.message_id)&&void 0!==t?t:null===(i=this.messageReaction)||void 0===i?void 0:i.message_id)&&void 0!==e?e:null===(r=this.messageReactionCount)||void 0===r?void 0:r.message_id}get chatId(){var e,t,n;return null!==(e=null===(t=this.chat)||void 0===t?void 0:t.id)&&void 0!==e?e:null===(n=this.businessConnection)||void 0===n?void 0:n.user_chat_id}get inlineMessageId(){var e,t,n;return null!==(e=null===(t=this.callbackQuery)||void 0===t?void 0:t.inline_message_id)&&void 0!==e?e:null===(n=this.chosenInlineResult)||void 0===n?void 0:n.inline_message_id}get businessConnectionId(){var e,t,n,i,r;return null!==(e=null!==(t=null===(n=this.msg)||void 0===n?void 0:n.business_connection_id)&&void 0!==t?t:null===(i=this.businessConnection)||void 0===i?void 0:i.id)&&void 0!==e?e:null===(r=this.deletedBusinessMessages)||void 0===r?void 0:r.business_connection_id}entities(e){var t,n;const i=this.msg;if(void 0===i)return[];const r=null!==(t=i.text)&&void 0!==t?t:i.caption;if(void 0===r)return[];let s=null!==(n=i.entities)&&void 0!==n?n:i.caption_entities;if(void 0===s)return[];if(void 0!==e){const t=new Set(S(e));s=s.filter((e=>t.has(e.type)))}return s.map((e=>({...e,text:r.substring(e.offset,e.offset+e.length)})))}reactions(){const e=[],t=[],n=[],i=[],r=[],s=[],o=[],a=[],u=this.messageReaction;if(void 0!==u){const{old_reaction:d,new_reaction:c}=u;for(const t of c)"emoji"===t.type?e.push(t.emoji):"custom_emoji"===t.type&&r.push(t.custom_emoji_id);for(const e of d)"emoji"===e.type?i.push(e.emoji):"custom_emoji"===e.type&&a.push(e.custom_emoji_id);t.push(...e),s.push(...r);for(let e=0;e<i.length;e++){const r=t.length;if(0===r)break;const s=i[e];for(let o=0;o<r;o++)if(s===t[o]){n.push(s),i.splice(e,1),t.splice(o,1),e--;break}}for(let e=0;e<a.length;e++){const t=s.length;if(0===t)break;const n=a[e];for(let i=0;i<t;i++)if(n===s[i]){o.push(n),a.splice(e,1),s.splice(i,1),e--;break}}}return{emoji:e,emojiAdded:t,emojiKept:n,emojiRemoved:i,customEmoji:r,customEmojiAdded:s,customEmojiKept:o,customEmojiRemoved:a}}has(e){return k.has.filterQuery(e)(this)}hasText(e){return k.has.text(e)(this)}hasCommand(e){return k.has.command(e)(this)}hasReaction(e){return k.has.reaction(e)(this)}hasChatType(e){return k.has.chatType(e)(this)}hasCallbackQuery(e){return k.has.callbackQuery(e)(this)}hasGameQuery(e){return k.has.gameQuery(e)(this)}hasInlineQuery(e){return k.has.inlineQuery(e)(this)}hasChosenInlineResult(e){return k.has.chosenInlineResult(e)(this)}hasPreCheckoutQuery(e){return k.has.preCheckoutQuery(e)(this)}hasShippingQuery(e){return k.has.shippingQuery(e)(this)}reply(e,t,n){return this.api.sendMessage(I(this.chatId,"sendMessage"),e,{business_connection_id:this.businessConnectionId,...t},n)}forwardMessage(e,t,n){return this.api.forwardMessage(e,I(this.chatId,"forwardMessage"),I(this.msgId,"forwardMessage"),t,n)}forwardMessages(e,t,n,i){return this.api.forwardMessages(e,I(this.chatId,"forwardMessages"),t,n,i)}copyMessage(e,t,n){return this.api.copyMessage(e,I(this.chatId,"copyMessage"),I(this.msgId,"copyMessage"),t,n)}copyMessages(e,t,n,i){return this.api.copyMessages(e,I(this.chatId,"copyMessages"),t,n,i)}replyWithPhoto(e,t,n){return this.api.sendPhoto(I(this.chatId,"sendPhoto"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithAudio(e,t,n){return this.api.sendAudio(I(this.chatId,"sendAudio"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithDocument(e,t,n){return this.api.sendDocument(I(this.chatId,"sendDocument"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithVideo(e,t,n){return this.api.sendVideo(I(this.chatId,"sendVideo"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithAnimation(e,t,n){return this.api.sendAnimation(I(this.chatId,"sendAnimation"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithVoice(e,t,n){return this.api.sendVoice(I(this.chatId,"sendVoice"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithVideoNote(e,t,n){return this.api.sendVideoNote(I(this.chatId,"sendVideoNote"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithMediaGroup(e,t,n){return this.api.sendMediaGroup(I(this.chatId,"sendMediaGroup"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithLocation(e,t,n,i){return this.api.sendLocation(I(this.chatId,"sendLocation"),e,t,{business_connection_id:this.businessConnectionId,...n},i)}editMessageLiveLocation(e,t,n,i){const r=this.inlineMessageId;return void 0!==r?this.api.editMessageLiveLocationInline(r,e,t,n):this.api.editMessageLiveLocation(I(this.chatId,"editMessageLiveLocation"),I(this.msgId,"editMessageLiveLocation"),e,t,n,i)}stopMessageLiveLocation(e,t){const n=this.inlineMessageId;return void 0!==n?this.api.stopMessageLiveLocationInline(n,e):this.api.stopMessageLiveLocation(I(this.chatId,"stopMessageLiveLocation"),I(this.msgId,"stopMessageLiveLocation"),e,t)}sendPaidMedia(e,t,n,i){return this.api.sendPaidMedia(I(this.chatId,"sendPaidMedia"),e,t,n,i)}replyWithVenue(e,t,n,i,r,s){return this.api.sendVenue(I(this.chatId,"sendVenue"),e,t,n,i,{business_connection_id:this.businessConnectionId,...r},s)}replyWithContact(e,t,n,i){return this.api.sendContact(I(this.chatId,"sendContact"),e,t,{business_connection_id:this.businessConnectionId,...n},i)}replyWithPoll(e,t,n,i){return this.api.sendPoll(I(this.chatId,"sendPoll"),e,t,{business_connection_id:this.businessConnectionId,...n},i)}replyWithDice(e,t,n){return this.api.sendDice(I(this.chatId,"sendDice"),e,{business_connection_id:this.businessConnectionId,...t},n)}replyWithChatAction(e,t,n){return this.api.sendChatAction(I(this.chatId,"sendChatAction"),e,{business_connection_id:this.businessConnectionId,...t},n)}react(e,t,n){return this.api.setMessageReaction(I(this.chatId,"setMessageReaction"),I(this.msgId,"setMessageReaction"),"string"===typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"===typeof e?{type:"emoji",emoji:e}:e)),t,n)}getUserProfilePhotos(e,t){return this.api.getUserProfilePhotos(I(this.from,"getUserProfilePhotos").id,e,t)}getUserChatBoosts(e,t){return this.api.getUserChatBoosts(e,I(this.from,"getUserChatBoosts").id,t)}getBusinessConnection(e){return this.api.getBusinessConnection(I(this.businessConnectionId,"getBusinessConnection"),e)}getFile(e){var t,n,i,r,s,o;const a=I(this.msg,"getFile"),u=void 0!==a.photo?a.photo[a.photo.length-1]:null!==(t=null!==(n=null!==(i=null!==(r=null!==(s=null!==(o=a.animation)&&void 0!==o?o:a.audio)&&void 0!==s?s:a.document)&&void 0!==r?r:a.video)&&void 0!==i?i:a.video_note)&&void 0!==n?n:a.voice)&&void 0!==t?t:a.sticker;return this.api.getFile(I(u,"getFile").file_id,e)}kickAuthor(){return this.banAuthor(...arguments)}banAuthor(e,t){return this.api.banChatMember(I(this.chatId,"banAuthor"),I(this.from,"banAuthor").id,e,t)}kickChatMember(){return this.banChatMember(...arguments)}banChatMember(e,t,n){return this.api.banChatMember(I(this.chatId,"banChatMember"),e,t,n)}unbanChatMember(e,t,n){return this.api.unbanChatMember(I(this.chatId,"unbanChatMember"),e,t,n)}restrictAuthor(e,t,n){return this.api.restrictChatMember(I(this.chatId,"restrictAuthor"),I(this.from,"restrictAuthor").id,e,t,n)}restrictChatMember(e,t,n,i){return this.api.restrictChatMember(I(this.chatId,"restrictChatMember"),e,t,n,i)}promoteAuthor(e,t){return this.api.promoteChatMember(I(this.chatId,"promoteAuthor"),I(this.from,"promoteAuthor").id,e,t)}promoteChatMember(e,t,n){return this.api.promoteChatMember(I(this.chatId,"promoteChatMember"),e,t,n)}setChatAdministratorAuthorCustomTitle(e,t){return this.api.setChatAdministratorCustomTitle(I(this.chatId,"setChatAdministratorAuthorCustomTitle"),I(this.from,"setChatAdministratorAuthorCustomTitle").id,e,t)}setChatAdministratorCustomTitle(e,t,n){return this.api.setChatAdministratorCustomTitle(I(this.chatId,"setChatAdministratorCustomTitle"),e,t,n)}banChatSenderChat(e,t){return this.api.banChatSenderChat(I(this.chatId,"banChatSenderChat"),e,t)}unbanChatSenderChat(e,t){return this.api.unbanChatSenderChat(I(this.chatId,"unbanChatSenderChat"),e,t)}setChatPermissions(e,t,n){return this.api.setChatPermissions(I(this.chatId,"setChatPermissions"),e,t,n)}exportChatInviteLink(e){return this.api.exportChatInviteLink(I(this.chatId,"exportChatInviteLink"),e)}createChatInviteLink(e,t){return this.api.createChatInviteLink(I(this.chatId,"createChatInviteLink"),e,t)}editChatInviteLink(e,t,n){return this.api.editChatInviteLink(I(this.chatId,"editChatInviteLink"),e,t,n)}revokeChatInviteLink(e,t){return this.api.revokeChatInviteLink(I(this.chatId,"editChatInviteLink"),e,t)}approveChatJoinRequest(e,t){return this.api.approveChatJoinRequest(I(this.chatId,"approveChatJoinRequest"),e,t)}declineChatJoinRequest(e,t){return this.api.declineChatJoinRequest(I(this.chatId,"declineChatJoinRequest"),e,t)}setChatPhoto(e,t){return this.api.setChatPhoto(I(this.chatId,"setChatPhoto"),e,t)}deleteChatPhoto(e){return this.api.deleteChatPhoto(I(this.chatId,"deleteChatPhoto"),e)}setChatTitle(e,t){return this.api.setChatTitle(I(this.chatId,"setChatTitle"),e,t)}setChatDescription(e,t){return this.api.setChatDescription(I(this.chatId,"setChatDescription"),e,t)}pinChatMessage(e,t,n){return this.api.pinChatMessage(I(this.chatId,"pinChatMessage"),e,t,n)}unpinChatMessage(e,t){return this.api.unpinChatMessage(I(this.chatId,"unpinChatMessage"),e,t)}unpinAllChatMessages(e){return this.api.unpinAllChatMessages(I(this.chatId,"unpinAllChatMessages"),e)}leaveChat(e){return this.api.leaveChat(I(this.chatId,"leaveChat"),e)}getChat(e){return this.api.getChat(I(this.chatId,"getChat"),e)}getChatAdministrators(e){return this.api.getChatAdministrators(I(this.chatId,"getChatAdministrators"),e)}getChatMembersCount(){return this.getChatMemberCount(...arguments)}getChatMemberCount(e){return this.api.getChatMemberCount(I(this.chatId,"getChatMemberCount"),e)}getAuthor(e){return this.api.getChatMember(I(this.chatId,"getAuthor"),I(this.from,"getAuthor").id,e)}getChatMember(e,t){return this.api.getChatMember(I(this.chatId,"getChatMember"),e,t)}setChatStickerSet(e,t){return this.api.setChatStickerSet(I(this.chatId,"setChatStickerSet"),e,t)}deleteChatStickerSet(e){return this.api.deleteChatStickerSet(I(this.chatId,"deleteChatStickerSet"),e)}createForumTopic(e,t,n){return this.api.createForumTopic(I(this.chatId,"createForumTopic"),e,t,n)}editForumTopic(e,t){const n=I(this.msg,"editForumTopic"),i=I(n.message_thread_id,"editForumTopic");return this.api.editForumTopic(n.chat.id,i,e,t)}closeForumTopic(e){const t=I(this.msg,"closeForumTopic"),n=I(t.message_thread_id,"closeForumTopic");return this.api.closeForumTopic(t.chat.id,n,e)}reopenForumTopic(e){const t=I(this.msg,"reopenForumTopic"),n=I(t.message_thread_id,"reopenForumTopic");return this.api.reopenForumTopic(t.chat.id,n,e)}deleteForumTopic(e){const t=I(this.msg,"deleteForumTopic"),n=I(t.message_thread_id,"deleteForumTopic");return this.api.deleteForumTopic(t.chat.id,n,e)}unpinAllForumTopicMessages(e){const t=I(this.msg,"unpinAllForumTopicMessages"),n=I(t.message_thread_id,"unpinAllForumTopicMessages");return this.api.unpinAllForumTopicMessages(t.chat.id,n,e)}editGeneralForumTopic(e,t){return this.api.editGeneralForumTopic(I(this.chatId,"editGeneralForumTopic"),e,t)}closeGeneralForumTopic(e){return this.api.closeGeneralForumTopic(I(this.chatId,"closeGeneralForumTopic"),e)}reopenGeneralForumTopic(e){return this.api.reopenGeneralForumTopic(I(this.chatId,"reopenGeneralForumTopic"),e)}hideGeneralForumTopic(e){return this.api.hideGeneralForumTopic(I(this.chatId,"hideGeneralForumTopic"),e)}unhideGeneralForumTopic(e){return this.api.unhideGeneralForumTopic(I(this.chatId,"unhideGeneralForumTopic"),e)}unpinAllGeneralForumTopicMessages(e){return this.api.unpinAllGeneralForumTopicMessages(I(this.chatId,"unpinAllGeneralForumTopicMessages"),e)}answerCallbackQuery(e,t){return this.api.answerCallbackQuery(I(this.callbackQuery,"answerCallbackQuery").id,"string"===typeof e?{text:e}:e,t)}setChatMenuButton(e,t){return this.api.setChatMenuButton(e,t)}getChatMenuButton(e,t){return this.api.getChatMenuButton(e,t)}setMyDefaultAdministratorRights(e,t){return this.api.setMyDefaultAdministratorRights(e,t)}getMyDefaultAdministratorRights(e,t){return this.api.getMyDefaultAdministratorRights(e,t)}editMessageText(e,t,n){var i,r,s,o,a;const u=this.inlineMessageId;return void 0!==u?this.api.editMessageTextInline(u,e,t):this.api.editMessageText(I(this.chatId,"editMessageText"),I(null!==(i=null!==(r=null===(s=this.msg)||void 0===s?void 0:s.message_id)&&void 0!==r?r:null===(o=this.messageReaction)||void 0===o?void 0:o.message_id)&&void 0!==i?i:null===(a=this.messageReactionCount)||void 0===a?void 0:a.message_id,"editMessageText"),e,t,n)}editMessageCaption(e,t){var n,i,r,s,o;const a=this.inlineMessageId;return void 0!==a?this.api.editMessageCaptionInline(a,e):this.api.editMessageCaption(I(this.chatId,"editMessageCaption"),I(null!==(n=null!==(i=null===(r=this.msg)||void 0===r?void 0:r.message_id)&&void 0!==i?i:null===(s=this.messageReaction)||void 0===s?void 0:s.message_id)&&void 0!==n?n:null===(o=this.messageReactionCount)||void 0===o?void 0:o.message_id,"editMessageCaption"),e,t)}editMessageMedia(e,t,n){var i,r,s,o,a;const u=this.inlineMessageId;return void 0!==u?this.api.editMessageMediaInline(u,e,t):this.api.editMessageMedia(I(this.chatId,"editMessageMedia"),I(null!==(i=null!==(r=null===(s=this.msg)||void 0===s?void 0:s.message_id)&&void 0!==r?r:null===(o=this.messageReaction)||void 0===o?void 0:o.message_id)&&void 0!==i?i:null===(a=this.messageReactionCount)||void 0===a?void 0:a.message_id,"editMessageMedia"),e,t,n)}editMessageReplyMarkup(e,t){var n,i,r,s,o;const a=this.inlineMessageId;return void 0!==a?this.api.editMessageReplyMarkupInline(a,e):this.api.editMessageReplyMarkup(I(this.chatId,"editMessageReplyMarkup"),I(null!==(n=null!==(i=null===(r=this.msg)||void 0===r?void 0:r.message_id)&&void 0!==i?i:null===(s=this.messageReaction)||void 0===s?void 0:s.message_id)&&void 0!==n?n:null===(o=this.messageReactionCount)||void 0===o?void 0:o.message_id,"editMessageReplyMarkup"),e,t)}stopPoll(e,t){var n,i,r,s,o;return this.api.stopPoll(I(this.chatId,"stopPoll"),I(null!==(n=null!==(i=null===(r=this.msg)||void 0===r?void 0:r.message_id)&&void 0!==i?i:null===(s=this.messageReaction)||void 0===s?void 0:s.message_id)&&void 0!==n?n:null===(o=this.messageReactionCount)||void 0===o?void 0:o.message_id,"stopPoll"),e,t)}deleteMessage(e){var t,n,i,r,s;return this.api.deleteMessage(I(this.chatId,"deleteMessage"),I(null!==(t=null!==(n=null===(i=this.msg)||void 0===i?void 0:i.message_id)&&void 0!==n?n:null===(r=this.messageReaction)||void 0===r?void 0:r.message_id)&&void 0!==t?t:null===(s=this.messageReactionCount)||void 0===s?void 0:s.message_id,"deleteMessage"),e)}deleteMessages(e,t){return this.api.deleteMessages(I(this.chatId,"deleteMessages"),e,t)}replyWithSticker(e,t,n){return this.api.sendSticker(I(this.chatId,"sendSticker"),e,{business_connection_id:this.businessConnectionId,...t},n)}getCustomEmojiStickers(e){var t,n;return this.api.getCustomEmojiStickers((null!==(t=null===(n=this.msg)||void 0===n?void 0:n.entities)&&void 0!==t?t:[]).filter((e=>"custom_emoji"===e.type)).map((e=>e.custom_emoji_id)),e)}answerInlineQuery(e,t,n){return this.api.answerInlineQuery(I(this.inlineQuery,"answerInlineQuery").id,e,t,n)}replyWithInvoice(e,t,n,i,r,s,o){return this.api.sendInvoice(I(this.chatId,"sendInvoice"),e,t,n,i,r,s,o)}answerShippingQuery(e,t,n){return this.api.answerShippingQuery(I(this.shippingQuery,"answerShippingQuery").id,e,t,n)}answerPreCheckoutQuery(e,t,n){return this.api.answerPreCheckoutQuery(I(this.preCheckoutQuery,"answerPreCheckoutQuery").id,e,"string"===typeof t?{error_message:t}:t,n)}refundStarPayment(e){var t;return this.api.refundStarPayment(I(this.from,"refundStarPayment").id,I(null===(t=this.msg)||void 0===t?void 0:t.successful_payment,"refundStarPayment").telegram_payment_charge_id,e)}setPassportDataErrors(e,t){return this.api.setPassportDataErrors(I(this.from,"setPassportDataErrors").id,e,t)}replyWithGame(e,t,n){return this.api.sendGame(I(this.chatId,"sendGame"),e,{business_connection_id:this.businessConnectionId,...t},n)}}function I(e,t){if(void 0===e)throw new Error("Missing information for API call to ".concat(t));return e}function A(e){return S(e).map((e=>"string"===typeof e?t=>t===e?e:null:t=>t.match(e)))}function T(e,t,n){for(const i of n){const n=i(t);if(n)return e.match=n,!0}return!1}function S(e){return Array.isArray(e)?e:[e]}(0,i.A)(k,"has",M);class F extends Error{constructor(e,t){super(function(e){let t;if(e instanceof Error)t="".concat(e.name," in middleware: ").concat(e.message);else{const n=typeof e;switch(t="Non-error value of type ".concat(n," thrown in middleware"),n){case"bigint":case"boolean":case"number":case"symbol":t+=": ".concat(e);break;case"string":t+=": ".concat(String(e).substring(0,50));break;default:t+="!"}}return t}(e)),(0,i.A)(this,"error",void 0),(0,i.A)(this,"ctx",void 0),this.error=e,this.ctx=t,this.name="BotError",e instanceof Error&&(this.stack=e.stack)}}function P(e){return"function"===typeof e?e:(t,n)=>e.middleware()(t,n)}function j(e,t){return async(n,i)=>{let r=!1;await e(n,(async()=>{if(r)throw new Error("`next` already called before!");r=!0,await t(n,i)}))}}function x(e,t){return t()}const E=()=>Promise.resolve();async function R(e,t){await e(t,E)}class L{constructor(){(0,i.A)(this,"handler",void 0);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.handler=0===t.length?x:t.map(P).reduce(j)}middleware(){return this.handler}use(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=new L(...t);return this.handler=j(this.handler,P(i)),i}on(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.filterQuery(e),...n)}hears(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.text(e),...n)}command(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.command(e),...n)}reaction(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.reaction(e),...n)}chatType(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.chatType(e),...n)}callbackQuery(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.callbackQuery(e),...n)}gameQuery(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.gameQuery(e),...n)}inlineQuery(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.inlineQuery(e),...n)}chosenInlineResult(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.chosenInlineResult(e),...n)}preCheckoutQuery(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.preCheckoutQuery(e),...n)}shippingQuery(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter(k.has.shippingQuery(e),...n)}filter(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=new L(...n);return this.branch(e,r,x),r}drop(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.filter((async t=>!await e(t)),...n)}fork(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=new L(...t),r=P(i);return this.use(((e,t)=>Promise.all([t(),R(r,e)]))),i}lazy(e){return this.use((async(t,n)=>{const i=await e(t),r=Array.isArray(i)?i:[i];await P(new L(...r))(t,n)}))}route(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x;return this.lazy((async i=>{var r;const s=await e(i);return null!==(r=void 0!==s&&t[s]?t[s]:n)&&void 0!==r?r:[]}))}branch(e,t,n){return this.lazy((async i=>await e(i)?t:n))}errorBoundary(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const r=new L(...n),s=P(r);return this.use((async(t,n)=>{let i=!1;const r=()=>(i=!0,Promise.resolve());try{await s(t,r)}catch(o){i=!1,await e(new F(o,t),r)}i&&await n()})),r}}var N=1e3,D=60*N,Q=60*D,O=24*Q,U=7*O,q=365.25*O,G=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if(e=String(e),e.length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*q;case"weeks":case"week":case"w":return n*U;case"days":case"day":case"d":return n*O;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Q;case"minutes":case"minute":case"mins":case"min":case"m":return n*D;case"seconds":case"second":case"secs":case"sec":case"s":return n*N;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=O)return B(e,t,O,"day");if(t>=Q)return B(e,t,Q,"hour");if(t>=D)return B(e,t,D,"minute");if(t>=N)return B(e,t,N,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=O)return Math.round(e/O)+"d";if(t>=Q)return Math.round(e/Q)+"h";if(t>=D)return Math.round(e/D)+"m";if(t>=N)return Math.round(e/N)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function B(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}function W(){throw new Error("setTimeout has not been defined")}function z(){throw new Error("clearTimeout has not been defined")}var V,J=W,H=z;function K(e){if(J===setTimeout)return setTimeout(e,0);if((J===W||!J)&&setTimeout)return J=setTimeout,setTimeout(e,0);try{return J(e,0)}catch(t){try{return J.call(null,e,0)}catch(n){return J.call(this,e,0)}}}"function"===typeof(V="undefined"!==typeof window?window:"undefined"!==typeof self?self:{}).setTimeout&&(J=setTimeout),"function"===typeof V.clearTimeout&&(H=clearTimeout);var Y,$=[],X=!1,Z=-1;function ee(){X&&Y&&(X=!1,Y.length?$=Y.concat($):Z=-1,$.length&&te())}function te(){if(!X){var e=K(ee);X=!0;for(var t=$.length;t;){for(Y=$,$=[];++Z<t;)Y&&Y[Z].run();Z=-1,t=$.length}Y=null,X=!1,function(e){if(H===clearTimeout)return clearTimeout(e);if((H===z||!H)&&clearTimeout)return H=clearTimeout,clearTimeout(e);try{return H(e)}catch(t){try{return H.call(null,e)}catch(n){return H.call(this,e)}}}(e)}}function ne(e,t){this.fun=e,this.array=t}ne.prototype.run=function(){this.fun.apply(null,this.array)};function ie(){}var re=ie,se=ie,oe=ie,ae=ie,ue=ie,de=ie,ce=ie;var le=V.performance||{},he=le.now||le.mozNow||le.msNow||le.oNow||le.webkitNow||function(){return(new Date).getTime()};var pe=new Date;var me={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];$.push(new ne(e,t)),1!==$.length||X||K(te)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:re,addListener:se,once:oe,off:ae,removeListener:ue,removeAllListeners:de,emit:ce,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*he.call(le),n=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(n-=e[0],(i-=e[1])<0&&(n--,i+=1e9)),[n,i]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-pe)/1e3}};var ge,fe,ve,_e=function(e){function t(e){let i,r,s,o=null;function a(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!a.enabled)return;const s=a,o=Number(new Date),u=o-(i||o);s.diff=u,s.prev=i,s.curr=o,i=o,n[0]=t.coerce(n[0]),"string"!==typeof n[0]&&n.unshift("%O");let d=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((e,i)=>{if("%%"===e)return"%";d++;const r=t.formatters[i];if("function"===typeof r){const t=n[d];e=r.call(s,t),n.splice(d,1),d--}return e})),t.formatArgs.call(s,n);(s.log||t.log).apply(s,n)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(r!==t.namespaces&&(r=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"===typeof t.init&&t.init(a),a}function n(e,n){const i=t(this.namespace+("undefined"===typeof n?":":n)+e);return i.log=this.log,i}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const i=("string"===typeof e?e:"").split(/[\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&("-"===(e=i[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,i;for(n=0,i=t.skips.length;n<i;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;n<i;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=G,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},ye=(ge=function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(n){}return!e&&"undefined"!==typeof me&&"env"in me&&(e=me.env.DEBUG),e},t.useColors=function(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=_e(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},ge(ve={path:fe,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}((void 0===t||null===t)&&ve.path)}},ve.exports),ve.exports);ye.colors,ye.destroy,ye.formatArgs,ye.load,ye.log,ye.save,ye.storage,ye.useColors;const be=ye("grammy:warn");class Ce extends Error{constructor(e,t,n,r){var s;super("".concat(e," (").concat(t.error_code,": ").concat(t.description,")")),(0,i.A)(this,"method",void 0),(0,i.A)(this,"payload",void 0),(0,i.A)(this,"ok",void 0),(0,i.A)(this,"error_code",void 0),(0,i.A)(this,"description",void 0),(0,i.A)(this,"parameters",void 0),this.method=n,this.payload=r,this.ok=!1,this.name="GrammyError",this.error_code=t.error_code,this.description=t.description,this.parameters=null!==(s=t.parameters)&&void 0!==s?s:{}}}class we extends Error{constructor(e,t){super(e),(0,i.A)(this,"error",void 0),this.error=t,this.name="HttpError"}}const Me="windows"===((e,t,n)=>{const{Deno:i}=globalThis;if("string"===typeof(null===i||void 0===i||null===(e=i.build)||void 0===e?void 0:e.os))return i.build.os;const{navigator:r}=globalThis;return null!==r&&void 0!==r&&null!==(t=r.appVersion)&&void 0!==t&&null!==(n=t.includes)&&void 0!==n&&n.call(t,"Win")?"windows":"linux"})();function ke(e,t){if(t.length>=e.length)return e;const n=e.length-t.length;for(let i=t.length-1;i>=0;--i)if(e.charCodeAt(n+i)!==t.charCodeAt(i))return e;return e.slice(0,-t.length)}function Ie(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!1,r=e.length;for(let s=e.length-1;s>=n;--s)if(t(e.charCodeAt(s))){if(i){n=s+1;break}}else i||(i=!0,r=s+1);return e.slice(n,r)}function Ae(e,t){if(function(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received ".concat(JSON.stringify(e)))}(e),0===e.length)return e;if("string"!==typeof t)throw new TypeError("Suffix must be a string. Received ".concat(JSON.stringify(t)))}function Te(e,t){if(e.length<=1)return e;let n=e.length;for(let i=e.length-1;i>0&&t(e.charCodeAt(i));i--)n=i;return e.slice(0,n)}function Se(e){return 47===e}function Fe(e){return 47===e||92===e}function Pe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Me?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Ae(e,t);let n=0;if(e.length>=2){((i=e.charCodeAt(0))>=97&&i<=122||i>=65&&i<=90)&&58===e.charCodeAt(1)&&(n=2)}var i;const r=Te(Ie(e,Fe,n),Fe);return t?ke(r,t):r}(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Ae(e,t);const n=Te(Ie(e,Se),Se);return t?ke(n,t):n}(e,t)}class je{constructor(e,t){var n;(0,i.A)(this,"consumed",!1),(0,i.A)(this,"fileData",void 0),(0,i.A)(this,"filename",void 0),this.fileData=e,null!==(n=t)&&void 0!==n||(t=this.guessFilename(e)),this.filename=t}guessFilename(e){if("string"===typeof e)return Pe(e);if("object"===typeof e){if("url"in e)return Pe(e.url);if(e instanceof URL)return Pe(e.pathname)||Pe(e.hostname)}}toRaw(){if(this.consumed)throw new Error("Cannot reuse InputFile data source!");const e=this.fileData;return e instanceof Blob?e.stream():e instanceof URL?xe(e):"url"in e?xe(e.url):(e instanceof Uint8Array||(this.consumed=!0),e)}}async function*xe(e){const{body:t}=await fetch(e);if(null===t)throw new Error("Download failed, no response body from '".concat(e,"'"));yield*t}function Ee(e){return e instanceof je||"object"===typeof e&&null!==e&&Object.values(e).some((e=>Array.isArray(e)?e.some(Ee):e instanceof je||Ee(e)))}function Re(e){return JSON.stringify(e,((e,t)=>null!==t&&void 0!==t?t:void 0))}function Le(e){return{method:"POST",headers:{"content-type":"application/json",connection:"keep-alive"},body:Re(e)}}function Ne(e,t){const n="----------"+De(32),i=async function*(e,t){const n=Oe(e);yield Qe.encode("--".concat(t,"\r\n"));const i=Qe.encode("\r\n--".concat(t,"\r\n"));let r=!0;for(const[s,o]of Object.entries(e))null!=o&&(r||(yield i),yield Ue(s,"object"===typeof o?Re(o):o),r=!1);for(const{id:s,origin:o,file:a}of n)r||(yield i),yield*qe(s,o,a),r=!1;yield Qe.encode("\r\n--".concat(t,"--\r\n"))}(e,n),r=async function*(e,t){try{yield*e}catch(n){t(n)}}(i,t),s=(e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const n=await t.next();n.done?e.close():e.enqueue(n.value)}})})(r);return{method:"POST",headers:{"content-type":"multipart/form-data; boundary=".concat(n),connection:"keep-alive"},body:s}}function De(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;return Array.from(Array(e)).map((()=>Math.random().toString(36)[2]||0)).join("")}const Qe=new TextEncoder;function Oe(e){return"object"!==typeof e||null===e?[]:Object.entries(e).flatMap((t=>{let[n,i]=t;if(Array.isArray(i))return i.flatMap((e=>Oe(e)));if(i instanceof je){const t=De();Object.assign(e,{[n]:"attach://".concat(t)});return{id:t,origin:"media"===n&&"type"in e&&"string"===typeof e.type?e.type:n,file:i}}return Oe(i)}))}function Ue(e,t){return Qe.encode('content-disposition:form-data;name="'.concat(e,'"\r\n\r\n').concat(t))}async function*qe(e,t,n){const i=n.filename||"".concat(t,".").concat(function(e){switch(e){case"certificate":return"pem";case"photo":case"thumbnail":return"jpg";case"voice":return"ogg";case"audio":return"mp3";case"animation":case"video":case"video_note":return"mp4";case"sticker":return"webp";default:return"dat"}}(t));if(i.includes("\r")||i.includes("\n"))throw new Error("File paths cannot contain carriage-return (\\r) or newline (\\n) characters! Filename for property '".concat(t,'\' was:\n"""\n').concat(i,'\n"""'));yield Qe.encode('content-disposition:form-data;name="'.concat(e,'";filename=').concat(i,"\r\ncontent-type:application/octet-stream\r\n\r\n"));const r=await n.toRaw();r instanceof Uint8Array?yield r:yield*r}const Ge=ye("grammy:core");function Be(e,t){return(n,i,r)=>t(e,n,i,r)}class We{constructor(e){var t,n,r,s,o,a;let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.A)(this,"token",void 0),(0,i.A)(this,"webhookReplyEnvelope",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"hasUsedWebhookReply",void 0),(0,i.A)(this,"installedTransformers",void 0),(0,i.A)(this,"call",void 0),this.token=e,this.webhookReplyEnvelope=d,this.hasUsedWebhookReply=!1,this.installedTransformers=[],this.call=async(e,t,n)=>{const i=null!==t&&void 0!==t?t:{};Ge("Calling ".concat(e)),void 0!==n&&function(e,t,n){if("function"===typeof(null===n||void 0===n?void 0:n.addEventListener))return;let i=JSON.stringify(t);i.length>20&&(i=i.substring(0,16)+" ...");let r=JSON.stringify(n);r.length>20&&(r=r.substring(0,16)+" ...");throw new Error("Incorrect abort signal instance found! You passed two payloads to '".concat(e,"' but you should merge the second one containing '").concat(r,"' into the first one containing '").concat(i,"'! If you are using context shortcuts, you may want to use a method on 'ctx.api' instead.\n\nIf you want to prevent such mistakes in the future, consider using TypeScript. https://www.typescriptlang.org/"))}(e,i,n);const r=this.options,s=Ee(i);if(void 0!==this.webhookReplyEnvelope.send&&!this.hasUsedWebhookReply&&!s&&r.canUseWebhookReply(e)){this.hasUsedWebhookReply=!0;const t=Le({...i,method:e});return await this.webhookReplyEnvelope.send(t.body),{ok:!0,result:!0}}const o=function(e){const t=new AbortController;if(void 0===e)return t;const n=e;function i(){t.abort(),n.removeEventListener("abort",i)}n.aborted?i():n.addEventListener("abort",i);return{abort:i,signal:t.signal}}(n),a=function(e,t,n){let i;const r=new Promise(((r,s)=>{i=setTimeout((()=>{const i="Request to '".concat(n,"' timed out after ").concat(t," seconds");s(new Error(i)),e.abort()}),1e3*t)}));return{promise:r,handle:i}}(o,r.timeoutSeconds,e),u=function(e){let t=e=>{throw e};return{promise:new Promise(((n,i)=>{t=t=>{i(t),e.abort()}})),catch:t}}(o),d=r.buildUrl(r.apiRoot,this.token,e,r.environment),c=s?Ne(i,(e=>u.catch(e))):Le(i),l=o.signal,h={...r.baseFetchConfig,signal:l,...c},p=fetch(d instanceof URL?d.href:d,h).catch(function(e,t){return n=>{let i="Network request for '".concat(e,"' failed!");throw function(e){return"object"===typeof e&&null!==e&&"status"in e&&"statusText"in e}(n)&&(i+=" (".concat(n.status,": ").concat(n.statusText,")")),t&&n instanceof Error&&(i+=" ".concat(n.message)),new we(i,n)}}(e,r.sensitiveLogs)),m=[p,u.promise,a.promise];try{const e=await Promise.race(m);return await e.json()}finally{void 0!==a.handle&&clearTimeout(a.handle)}};const c=null!==(t=u.apiRoot)&&void 0!==t?t:"https://api.telegram.org",l=null!==(n=u.environment)&&void 0!==n?n:"prod";if(this.options={apiRoot:c,environment:l,buildUrl:null!==(r=u.buildUrl)&&void 0!==r?r:ze,timeoutSeconds:null!==(s=u.timeoutSeconds)&&void 0!==s?s:500,baseFetchConfig:{...u.baseFetchConfig},canUseWebhookReply:null!==(o=u.canUseWebhookReply)&&void 0!==o?o:()=>!1,sensitiveLogs:null!==(a=u.sensitiveLogs)&&void 0!==a&&a},this.options.apiRoot.endsWith("/"))throw new Error("Remove the trailing '/' from the 'apiRoot' option (use '".concat(this.options.apiRoot.substring(0,this.options.apiRoot.length-1),"' instead of '").concat(this.options.apiRoot,"')"))}use(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.call=t.reduce(Be,this.call),this.installedTransformers.push(...t),this}async callApi(e,t,n){const i=await this.call(e,t,n);if(i.ok)return i.result;throw function(e,t,n){switch(e.error_code){case 401:be("Error 401 means that your bot token is wrong, talk to https://t.me/BotFather to check it.");break;case 409:be("Error 409 means that you are running your bot several times on long polling. Consider revoking the bot token if you believe that no other instance is running.")}return new Ce("Call to '".concat(t,"' failed!"),e,t,n)}(i,e,t)}}const ze=(e,t,n,i)=>{const r="test"===i?"test/":"";return"".concat(e,"/bot").concat(t,"/").concat(r).concat(n)},Ve={set:()=>!1,defineProperty:()=>!1,deleteProperty:()=>!1,ownKeys:()=>[]};class Je{constructor(e,t,n){(0,i.A)(this,"token",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"raw",void 0),(0,i.A)(this,"config",void 0),this.token=e,this.options=t;const{raw:r,use:s,installedTransformers:o}=function(e,t,n){const i=new We(e,t,n),r={get:(e,t)=>"toJSON"===t?"__internal":i.callApi.bind(i,t),...Ve},s={raw:new Proxy({},r),installedTransformers:i.installedTransformers,use:function(){return i.use(...arguments),s}};return s}(e,t,n);this.raw=r,this.config={use:s,installedTransformers:()=>o.slice()}}getUpdates(e,t){return this.raw.getUpdates({...e},t)}setWebhook(e,t,n){return this.raw.setWebhook({url:e,...t},n)}deleteWebhook(e,t){return this.raw.deleteWebhook({...e},t)}getWebhookInfo(e){return this.raw.getWebhookInfo(e)}getMe(e){return this.raw.getMe(e)}logOut(e){return this.raw.logOut(e)}close(e){return this.raw.close(e)}sendMessage(e,t,n,i){return this.raw.sendMessage({chat_id:e,text:t,...n},i)}forwardMessage(e,t,n,i,r){return this.raw.forwardMessage({chat_id:e,from_chat_id:t,message_id:n,...i},r)}forwardMessages(e,t,n,i,r){return this.raw.forwardMessages({chat_id:e,from_chat_id:t,message_ids:n,...i},r)}copyMessage(e,t,n,i,r){return this.raw.copyMessage({chat_id:e,from_chat_id:t,message_id:n,...i},r)}copyMessages(e,t,n,i,r){return this.raw.copyMessages({chat_id:e,from_chat_id:t,message_ids:n,...i},r)}sendPhoto(e,t,n,i){return this.raw.sendPhoto({chat_id:e,photo:t,...n},i)}sendAudio(e,t,n,i){return this.raw.sendAudio({chat_id:e,audio:t,...n},i)}sendDocument(e,t,n,i){return this.raw.sendDocument({chat_id:e,document:t,...n},i)}sendVideo(e,t,n,i){return this.raw.sendVideo({chat_id:e,video:t,...n},i)}sendAnimation(e,t,n,i){return this.raw.sendAnimation({chat_id:e,animation:t,...n},i)}sendVoice(e,t,n,i){return this.raw.sendVoice({chat_id:e,voice:t,...n},i)}sendVideoNote(e,t,n,i){return this.raw.sendVideoNote({chat_id:e,video_note:t,...n},i)}sendMediaGroup(e,t,n,i){return this.raw.sendMediaGroup({chat_id:e,media:t,...n},i)}sendLocation(e,t,n,i,r){return this.raw.sendLocation({chat_id:e,latitude:t,longitude:n,...i},r)}editMessageLiveLocation(e,t,n,i,r,s){return this.raw.editMessageLiveLocation({chat_id:e,message_id:t,latitude:n,longitude:i,...r},s)}editMessageLiveLocationInline(e,t,n,i,r){return this.raw.editMessageLiveLocation({inline_message_id:e,latitude:t,longitude:n,...i},r)}stopMessageLiveLocation(e,t,n,i){return this.raw.stopMessageLiveLocation({chat_id:e,message_id:t,...n},i)}stopMessageLiveLocationInline(e,t,n){return this.raw.stopMessageLiveLocation({inline_message_id:e,...t},n)}sendPaidMedia(e,t,n,i,r){return this.raw.sendPaidMedia({chat_id:e,star_count:t,media:n,...i},r)}sendVenue(e,t,n,i,r,s,o){return this.raw.sendVenue({chat_id:e,latitude:t,longitude:n,title:i,address:r,...s},o)}sendContact(e,t,n,i,r){return this.raw.sendContact({chat_id:e,phone_number:t,first_name:n,...i},r)}sendPoll(e,t,n,i,r){return this.raw.sendPoll({chat_id:e,question:t,options:n,...i},r)}sendDice(e,t,n,i){return this.raw.sendDice({chat_id:e,emoji:t,...n},i)}setMessageReaction(e,t,n,i,r){return this.raw.setMessageReaction({chat_id:e,message_id:t,reaction:n,...i},r)}sendChatAction(e,t,n,i){return this.raw.sendChatAction({chat_id:e,action:t,...n},i)}getUserProfilePhotos(e,t,n){return this.raw.getUserProfilePhotos({user_id:e,...t},n)}getUserChatBoosts(e,t,n){return this.raw.getUserChatBoosts({chat_id:e,user_id:t},n)}getBusinessConnection(e,t){return this.raw.getBusinessConnection({business_connection_id:e},t)}getFile(e,t){return this.raw.getFile({file_id:e},t)}kickChatMember(){return this.banChatMember(...arguments)}banChatMember(e,t,n,i){return this.raw.banChatMember({chat_id:e,user_id:t,...n},i)}unbanChatMember(e,t,n,i){return this.raw.unbanChatMember({chat_id:e,user_id:t,...n},i)}restrictChatMember(e,t,n,i,r){return this.raw.restrictChatMember({chat_id:e,user_id:t,permissions:n,...i},r)}promoteChatMember(e,t,n,i){return this.raw.promoteChatMember({chat_id:e,user_id:t,...n},i)}setChatAdministratorCustomTitle(e,t,n,i){return this.raw.setChatAdministratorCustomTitle({chat_id:e,user_id:t,custom_title:n},i)}banChatSenderChat(e,t,n){return this.raw.banChatSenderChat({chat_id:e,sender_chat_id:t},n)}unbanChatSenderChat(e,t,n){return this.raw.unbanChatSenderChat({chat_id:e,sender_chat_id:t},n)}setChatPermissions(e,t,n,i){return this.raw.setChatPermissions({chat_id:e,permissions:t,...n},i)}exportChatInviteLink(e,t){return this.raw.exportChatInviteLink({chat_id:e},t)}createChatInviteLink(e,t,n){return this.raw.createChatInviteLink({chat_id:e,...t},n)}editChatInviteLink(e,t,n,i){return this.raw.editChatInviteLink({chat_id:e,invite_link:t,...n},i)}revokeChatInviteLink(e,t,n){return this.raw.revokeChatInviteLink({chat_id:e,invite_link:t},n)}approveChatJoinRequest(e,t,n){return this.raw.approveChatJoinRequest({chat_id:e,user_id:t},n)}declineChatJoinRequest(e,t,n){return this.raw.declineChatJoinRequest({chat_id:e,user_id:t},n)}setChatPhoto(e,t,n){return this.raw.setChatPhoto({chat_id:e,photo:t},n)}deleteChatPhoto(e,t){return this.raw.deleteChatPhoto({chat_id:e},t)}setChatTitle(e,t,n){return this.raw.setChatTitle({chat_id:e,title:t},n)}setChatDescription(e,t,n){return this.raw.setChatDescription({chat_id:e,description:t},n)}pinChatMessage(e,t,n,i){return this.raw.pinChatMessage({chat_id:e,message_id:t,...n},i)}unpinChatMessage(e,t,n){return this.raw.unpinChatMessage({chat_id:e,message_id:t},n)}unpinAllChatMessages(e,t){return this.raw.unpinAllChatMessages({chat_id:e},t)}leaveChat(e,t){return this.raw.leaveChat({chat_id:e},t)}getChat(e,t){return this.raw.getChat({chat_id:e},t)}getChatAdministrators(e,t){return this.raw.getChatAdministrators({chat_id:e},t)}getChatMembersCount(){return this.getChatMemberCount(...arguments)}getChatMemberCount(e,t){return this.raw.getChatMemberCount({chat_id:e},t)}getChatMember(e,t,n){return this.raw.getChatMember({chat_id:e,user_id:t},n)}setChatStickerSet(e,t,n){return this.raw.setChatStickerSet({chat_id:e,sticker_set_name:t},n)}deleteChatStickerSet(e,t){return this.raw.deleteChatStickerSet({chat_id:e},t)}getForumTopicIconStickers(e){return this.raw.getForumTopicIconStickers(e)}createForumTopic(e,t,n,i){return this.raw.createForumTopic({chat_id:e,name:t,...n},i)}editForumTopic(e,t,n,i){return this.raw.editForumTopic({chat_id:e,message_thread_id:t,...n},i)}closeForumTopic(e,t,n){return this.raw.closeForumTopic({chat_id:e,message_thread_id:t},n)}reopenForumTopic(e,t,n){return this.raw.reopenForumTopic({chat_id:e,message_thread_id:t},n)}deleteForumTopic(e,t,n){return this.raw.deleteForumTopic({chat_id:e,message_thread_id:t},n)}unpinAllForumTopicMessages(e,t,n){return this.raw.unpinAllForumTopicMessages({chat_id:e,message_thread_id:t},n)}editGeneralForumTopic(e,t,n){return this.raw.editGeneralForumTopic({chat_id:e,name:t},n)}closeGeneralForumTopic(e,t){return this.raw.closeGeneralForumTopic({chat_id:e},t)}reopenGeneralForumTopic(e,t){return this.raw.reopenGeneralForumTopic({chat_id:e},t)}hideGeneralForumTopic(e,t){return this.raw.hideGeneralForumTopic({chat_id:e},t)}unhideGeneralForumTopic(e,t){return this.raw.unhideGeneralForumTopic({chat_id:e},t)}unpinAllGeneralForumTopicMessages(e,t){return this.raw.unpinAllGeneralForumTopicMessages({chat_id:e},t)}answerCallbackQuery(e,t,n){return this.raw.answerCallbackQuery({callback_query_id:e,...t},n)}setMyName(e,t,n){return this.raw.setMyName({name:e,...t},n)}getMyName(e,t){return this.raw.getMyName(null!==e&&void 0!==e?e:{},t)}setMyCommands(e,t,n){return this.raw.setMyCommands({commands:e,...t},n)}deleteMyCommands(e,t){return this.raw.deleteMyCommands({...e},t)}getMyCommands(e,t){return this.raw.getMyCommands({...e},t)}setMyDescription(e,t,n){return this.raw.setMyDescription({description:e,...t},n)}getMyDescription(e,t){return this.raw.getMyDescription({...e},t)}setMyShortDescription(e,t,n){return this.raw.setMyShortDescription({short_description:e,...t},n)}getMyShortDescription(e,t){return this.raw.getMyShortDescription({...e},t)}setChatMenuButton(e,t){return this.raw.setChatMenuButton({...e},t)}getChatMenuButton(e,t){return this.raw.getChatMenuButton({...e},t)}setMyDefaultAdministratorRights(e,t){return this.raw.setMyDefaultAdministratorRights({...e},t)}getMyDefaultAdministratorRights(e,t){return this.raw.getMyDefaultAdministratorRights({...e},t)}editMessageText(e,t,n,i,r){return this.raw.editMessageText({chat_id:e,message_id:t,text:n,...i},r)}editMessageTextInline(e,t,n,i){return this.raw.editMessageText({inline_message_id:e,text:t,...n},i)}editMessageCaption(e,t,n,i){return this.raw.editMessageCaption({chat_id:e,message_id:t,...n},i)}editMessageCaptionInline(e,t,n){return this.raw.editMessageCaption({inline_message_id:e,...t},n)}editMessageMedia(e,t,n,i,r){return this.raw.editMessageMedia({chat_id:e,message_id:t,media:n,...i},r)}editMessageMediaInline(e,t,n,i){return this.raw.editMessageMedia({inline_message_id:e,media:t,...n},i)}editMessageReplyMarkup(e,t,n,i){return this.raw.editMessageReplyMarkup({chat_id:e,message_id:t,...n},i)}editMessageReplyMarkupInline(e,t,n){return this.raw.editMessageReplyMarkup({inline_message_id:e,...t},n)}stopPoll(e,t,n,i){return this.raw.stopPoll({chat_id:e,message_id:t,...n},i)}deleteMessage(e,t,n){return this.raw.deleteMessage({chat_id:e,message_id:t},n)}deleteMessages(e,t,n){return this.raw.deleteMessages({chat_id:e,message_ids:t},n)}sendSticker(e,t,n,i){return this.raw.sendSticker({chat_id:e,sticker:t,...n},i)}getStickerSet(e,t){return this.raw.getStickerSet({name:e},t)}getCustomEmojiStickers(e,t){return this.raw.getCustomEmojiStickers({custom_emoji_ids:e},t)}uploadStickerFile(e,t,n,i){return this.raw.uploadStickerFile({user_id:e,sticker_format:t,sticker:n},i)}createNewStickerSet(e,t,n,i,r,s){return this.raw.createNewStickerSet({user_id:e,name:t,title:n,stickers:i,...r},s)}addStickerToSet(e,t,n,i){return this.raw.addStickerToSet({user_id:e,name:t,sticker:n},i)}setStickerPositionInSet(e,t,n){return this.raw.setStickerPositionInSet({sticker:e,position:t},n)}deleteStickerFromSet(e,t){return this.raw.deleteStickerFromSet({sticker:e},t)}replaceStickerInSet(e,t,n,i,r){return this.raw.replaceStickerInSet({user_id:e,name:t,old_sticker:n,sticker:i},r)}setStickerEmojiList(e,t,n){return this.raw.setStickerEmojiList({sticker:e,emoji_list:t},n)}setStickerKeywords(e,t,n){return this.raw.setStickerKeywords({sticker:e,keywords:t},n)}setStickerMaskPosition(e,t,n){return this.raw.setStickerMaskPosition({sticker:e,mask_position:t},n)}setStickerSetTitle(e,t,n){return this.raw.setStickerSetTitle({name:e,title:t},n)}deleteStickerSet(e,t){return this.raw.deleteStickerSet({name:e},t)}setStickerSetThumbnail(e,t,n,i,r){return this.raw.setStickerSetThumbnail({name:e,user_id:t,thumbnail:n,format:i},r)}setCustomEmojiStickerSetThumbnail(e,t,n){return this.raw.setCustomEmojiStickerSetThumbnail({name:e,custom_emoji_id:t},n)}answerInlineQuery(e,t,n,i){return this.raw.answerInlineQuery({inline_query_id:e,results:t,...n},i)}answerWebAppQuery(e,t,n){return this.raw.answerWebAppQuery({web_app_query_id:e,result:t},n)}sendInvoice(e,t,n,i,r,s,o,a){return this.raw.sendInvoice({chat_id:e,title:t,description:n,payload:i,currency:r,prices:s,...o},a)}createInvoiceLink(e,t,n,i,r,s,o,a){return this.raw.createInvoiceLink({title:e,description:t,payload:n,provider_token:i,currency:r,prices:s,...o},a)}answerShippingQuery(e,t,n,i){return this.raw.answerShippingQuery({shipping_query_id:e,ok:t,...n},i)}answerPreCheckoutQuery(e,t,n,i){return this.raw.answerPreCheckoutQuery({pre_checkout_query_id:e,ok:t,...n},i)}getStarTransactions(e,t){return this.raw.getStarTransactions({...e},t)}refundStarPayment(e,t,n){return this.raw.refundStarPayment({user_id:e,telegram_payment_charge_id:t},n)}setPassportDataErrors(e,t,n){return this.raw.setPassportDataErrors({user_id:e,errors:t},n)}sendGame(e,t,n,i){return this.raw.sendGame({chat_id:e,game_short_name:t,...n},i)}setGameScore(e,t,n,i,r,s){return this.raw.setGameScore({chat_id:e,message_id:t,user_id:n,score:i,...r},s)}setGameScoreInline(e,t,n,i,r){return this.raw.setGameScore({inline_message_id:e,user_id:t,score:n,...i},r)}getGameHighScores(e,t,n,i){return this.raw.getGameHighScores({chat_id:e,message_id:t,user_id:n},i)}getGameHighScoresInline(e,t,n){return this.raw.getGameHighScores({inline_message_id:e,user_id:t},n)}}const He=ye("grammy:bot"),Ke=ye("grammy:warn"),Ye=ye("grammy:error"),$e=["message","edited_message","channel_post","edited_channel_post","business_connection","business_message","edited_business_message","deleted_business_messages","inline_query","chosen_inline_result","callback_query","shipping_query","pre_checkout_query","poll","poll_answer","my_chat_member","chat_join_request","chat_boost","removed_chat_boost"];class Xe extends L{constructor(e,t){var n;if(super(),(0,i.A)(this,"token",void 0),(0,i.A)(this,"pollingRunning",void 0),(0,i.A)(this,"pollingAbortController",void 0),(0,i.A)(this,"lastTriedUpdateId",void 0),(0,i.A)(this,"api",void 0),(0,i.A)(this,"me",void 0),(0,i.A)(this,"mePromise",void 0),(0,i.A)(this,"clientConfig",void 0),(0,i.A)(this,"ContextConstructor",void 0),(0,i.A)(this,"observedUpdateTypes",void 0),(0,i.A)(this,"errorHandler",void 0),this.token=e,this.pollingRunning=!1,this.lastTriedUpdateId=0,this.observedUpdateTypes=new Set,this.errorHandler=async e=>{var t;throw console.error("Error in middleware while handling update",null===(t=e.ctx)||void 0===t||null===(t=t.update)||void 0===t?void 0:t.update_id,e.error),console.error("No error handler was set!"),console.error("Set your own error handler with `bot.catch = ...`"),this.pollingRunning&&(console.error("Stopping bot"),await this.stop()),e},!e)throw new Error("Empty token!");this.me=null===t||void 0===t?void 0:t.botInfo,this.clientConfig=null===t||void 0===t?void 0:t.client,this.ContextConstructor=null!==(n=null===t||void 0===t?void 0:t.ContextConstructor)&&void 0!==n?n:k,this.api=new Je(e,this.clientConfig)}set botInfo(e){this.me=e}get botInfo(){if(void 0===this.me)throw new Error("Bot information unavailable! Make sure to call `await bot.init()` before accessing `bot.botInfo`!");return this.me}on(e){for(const[r]of o(e).flatMap(a))this.observedUpdateTypes.add(r);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return super.on(e,...n)}reaction(e){this.observedUpdateTypes.add("message_reaction");for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return super.reaction(e,...n)}isInited(){return void 0!==this.me}async init(e){if(!this.isInited()){var t;let n;He("Initializing bot"),null!==(t=this.mePromise)&&void 0!==t||(this.mePromise=Ze((()=>this.api.getMe(e)),e));try{n=await this.mePromise}finally{this.mePromise=void 0}void 0===this.me?this.me=n:He("Bot info was set by now, will not overwrite")}He("I am ".concat(this.me.username,"!"))}async handleUpdates(e){for(const n of e){this.lastTriedUpdateId=n.update_id;try{await this.handleUpdate(n)}catch(t){if(!(t instanceof F))throw console.error("FATAL: grammY unable to handle:",t),t;await this.errorHandler(t)}}}async handleUpdate(e,t){if(void 0===this.me)throw new Error("Bot not initialized! Either call `await bot.init()`, or directly set the `botInfo` option in the `Bot` constructor to specify a known bot info object.");He("Processing update ".concat(e.update_id));const n=new Je(this.token,this.clientConfig,t),i=this.api.config.installedTransformers();i.length>0&&n.config.use(...i);const r=new this.ContextConstructor(e,n,this.me);try{await R(this.middleware(),r)}catch(s){throw Ye("Error in middleware for update ".concat(e.update_id)),new F(s,r)}}async start(e){const t=[];var n;this.isInited()||t.push(this.init(null===(n=this.pollingAbortController)||void 0===n?void 0:n.signal));if(this.pollingRunning)return await Promise.all(t),void He("Simple long polling already running!");this.pollingRunning=!0,this.pollingAbortController=new AbortController;try{var i,r;t.push(Ze((async()=>{var t;await this.api.deleteWebhook({drop_pending_updates:null===e||void 0===e?void 0:e.drop_pending_updates},null===(t=this.pollingAbortController)||void 0===t?void 0:t.signal)}),null===(i=this.pollingAbortController)||void 0===i?void 0:i.signal)),await Promise.all(t),await(null===e||void 0===e||null===(r=e.onStart)||void 0===r?void 0:r.call(e,this.botInfo))}catch(s){throw this.pollingRunning=!1,this.pollingAbortController=void 0,s}this.pollingRunning&&(!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$e;const n=Array.from(e).filter((e=>!t.includes(e)));n.length>0&&Ke("You registered listeners for the following update types, but you did not specify them in `allowed_updates` so they may not be received: ".concat(n.map((e=>"'".concat(e,"'"))).join(", ")))}(this.observedUpdateTypes,null===e||void 0===e?void 0:e.allowed_updates),this.use=tt,He("Starting simple long polling"),await this.loop(e),He("Middleware is done running"))}async stop(){if(this.pollingRunning){var e;He("Stopping bot, saving update offset"),this.pollingRunning=!1,null===(e=this.pollingAbortController)||void 0===e||e.abort();const t=this.lastTriedUpdateId+1;await this.api.getUpdates({offset:t,limit:1}).finally((()=>this.pollingAbortController=void 0))}else He("Bot is not running!")}catch(e){this.errorHandler=e}async loop(e){var t,n;const i=null===e||void 0===e?void 0:e.limit,r=null!==(t=null===e||void 0===e?void 0:e.timeout)&&void 0!==t?t:30;let s=null!==(n=null===e||void 0===e?void 0:e.allowed_updates)&&void 0!==n?n:[];for(;this.pollingRunning;){const e=await this.fetchUpdates({limit:i,timeout:r,allowed_updates:s});if(void 0===e)break;await this.handleUpdates(e),s=void 0}}async fetchUpdates(e){let{limit:t,timeout:n,allowed_updates:i}=e;const r=this.lastTriedUpdateId+1;let s;do{try{var o;s=await this.api.getUpdates({offset:r,limit:t,timeout:n,allowed_updates:i},null===(o=this.pollingAbortController)||void 0===o?void 0:o.signal)}catch(a){await this.handlePollingError(a)}}while(void 0===s&&this.pollingRunning);return s}async handlePollingError(e){if(!this.pollingRunning)return void He("Pending getUpdates request cancelled");let t=3;if(e instanceof Ce){if(Ye(e.message),401===e.error_code||409===e.error_code)throw e;var n;429===e.error_code&&(Ye("Bot API server is closing."),t=null!==(n=e.parameters.retry_after)&&void 0!==n?n:t)}else Ye(e);Ye("Call to getUpdates failed, retrying in ".concat(t," seconds ...")),await et(t)}}async function Ze(e,t){let n=50;async function i(e){let i=!1,r="rethrow";if(e instanceof we)i=!0,r="retry";else if(e instanceof Ce)if(e.error_code>=500)i=!0,r="retry";else if(429===e.error_code){const s=e.parameters.retry_after;"number"===typeof s?(await et(s,t),n=50):i=!0,r="retry"}if(i){50!==n&&await et(n,t);const e=12e5;n=Math.min(e,2*n)}return r}let r={ok:!1};for(;!r.ok;)try{r={ok:!0,value:await e()}}catch(s){Ye(s);switch(await i(s)){case"retry":continue;case"rethrow":throw s}}return r.value}async function et(e,t){let n,i;function r(){var e;null===(e=i)||void 0===e||e(new Error("Aborted delay")),void 0!==n&&clearTimeout(n)}try{await new Promise(((s,o)=>{i=o,null!==t&&void 0!==t&&t.aborted?r():(null===t||void 0===t||t.addEventListener("abort",r),n=setTimeout(s,1e3*e))}))}finally{null===t||void 0===t||t.removeEventListener("abort",r)}}function tt(){throw new Error("It looks like you are registering more listeners on your bot from within other listeners! This means that every time your bot handles a message like this one, new listeners will be added. This list grows until your machine crashes, so grammY throws this error to tell you that you should probably do things a bit differently. If you're unsure how to resolve this problem, you can ask in the group chat: https://telegram.me/grammyjs\n\nOn the other hand, if you actually know what you're doing and you do need to install further middleware while your bot is running, consider installing a composer instance on your bot, and in turn augment the composer after the fact. This way, you can circumvent this protection against memory leaks.")}const nt=[...$e,"chat_member","message_reaction","message_reaction_count"],it={DEFAULT_UPDATE_TYPES:$e,ALL_UPDATE_TYPES:nt,ALL_CHAT_PERMISSIONS:{is_anonymous:!0,can_manage_chat:!0,can_delete_messages:!0,can_manage_video_chats:!0,can_restrict_members:!0,can_promote_members:!0,can_change_info:!0,can_invite_users:!0,can_post_stories:!0,can_edit_stories:!0,can_delete_stories:!0,can_post_messages:!0,can_edit_messages:!0,can_pin_messages:!0,can_manage_topics:!0}};Object.freeze(it);ye("grammy:session");const rt="X-Telegram-Bot-Api-Secret-Token",st=rt.toLowerCase(),ot="secret token is wrong",at=()=>new Response(null,{status:200}),ut=e=>new Response(e,{status:200,headers:{"Content-Type":"application/json"}}),dt=()=>new Response('"unauthorized"',{status:401,statusText:ot}),ct=(e,t)=>{const n=e.headers[st];return{update:new Promise(((t,n)=>{const i=[];e.on("data",(e=>i.push(e))).once("end",(()=>{const e=Buffer.concat(i).toString("utf-8");t(JSON.parse(e))})).once("error",n)})),header:Array.isArray(n)?n[0]:n,end:()=>t.end(),respond:e=>t.writeHead(200,{"Content-Type":"application/json"}).end(e),unauthorized:()=>t.writeHead(401).end(ot)}},lt={"aws-lambda":(e,t,n)=>{var i;return{update:JSON.parse(null!==(i=e.body)&&void 0!==i?i:"{}"),header:e.headers[rt],end:()=>n(null,{statusCode:200}),respond:e=>n(null,{statusCode:200,headers:{"Content-Type":"application/json"},body:e}),unauthorized:()=>n(null,{statusCode:401})}},"aws-lambda-async":(e,t)=>{var n;let i;return{update:JSON.parse(null!==(n=e.body)&&void 0!==n?n:"{}"),header:e.headers[rt],end:()=>i({statusCode:200}),respond:e=>i({statusCode:200,headers:{"Content-Type":"application/json"},body:e}),unauthorized:()=>i({statusCode:401}),handlerReturn:new Promise((e=>{i=e}))}},azure:(e,t)=>{var n;return{update:Promise.resolve(e.body),header:null===(n=t.res)||void 0===n||null===(n=n.headers)||void 0===n?void 0:n[rt],end:()=>t.res={status:200,body:""},respond:e=>{var n,i,r,s;null===(n=t.res)||void 0===n||null===(i=n.set)||void 0===i||i.call(n,"Content-Type","application/json"),null===(r=t.res)||void 0===r||null===(s=r.send)||void 0===s||s.call(r,e)},unauthorized:()=>{var e,n;null===(e=t.res)||void 0===e||null===(n=e.send)||void 0===n||n.call(e,401,ot)}}},bun:e=>{let t;return{update:e.json(),header:e.headers.get(rt)||void 0,end:()=>{t(at())},respond:e=>{t(ut(e))},unauthorized:()=>{t(dt())}}},cloudflare:e=>{let t;return e.respondWith(new Promise((e=>{t=e}))),{update:e.request.json(),header:e.request.headers.get(rt)||void 0,end:()=>{t(at())},respond:e=>{t(ut(e))},unauthorized:()=>{t(dt())}}},"cloudflare-mod":e=>{let t;return{update:e.json(),header:e.headers.get(rt)||void 0,end:()=>{t(at())},respond:e=>{t(ut(e))},unauthorized:()=>{t(dt())},handlerReturn:new Promise((e=>{t=e}))}},express:(e,t)=>({update:Promise.resolve(e.body),header:e.header(rt),end:()=>t.end(),respond:e=>{t.set("Content-Type","application/json"),t.send(e)},unauthorized:()=>{t.status(401).send(ot)}}),fastify:(e,t)=>({update:Promise.resolve(e.body),header:e.headers[st],end:()=>t.status(200).send(),respond:e=>t.headers({"Content-Type":"application/json"}).send(e),unauthorized:()=>t.code(401).send(ot)}),hono:e=>{let t;return{update:e.req.json(),header:e.req.header(rt),end:()=>{t(e.body(null))},respond:n=>{t(e.json(n))},unauthorized:()=>{e.status(401),t(e.body(null))},handlerReturn:new Promise((e=>{t=e}))}},http:ct,https:ct,koa:e=>({update:Promise.resolve(e.request.body),header:e.get(rt)||void 0,end:()=>{e.body=""},respond:t=>{e.set("Content-Type","application/json"),e.response.body=t},unauthorized:()=>{e.status=401}}),"next-js":(e,t)=>({update:Promise.resolve(e.body),header:e.headers[st],end:()=>t.end(),respond:e=>t.status(200).json(e),unauthorized:()=>t.status(401).send(ot)}),nhttp:e=>({update:Promise.resolve(e.body),header:e.headers.get(rt)||void 0,end:()=>e.response.sendStatus(200),respond:t=>e.response.status(200).send(t),unauthorized:()=>e.response.status(401).send(ot)}),oak:e=>({update:e.request.body.json(),header:e.request.headers.get(rt)||void 0,end:()=>{e.response.status=200},respond:t=>{e.response.type="json",e.response.body=t},unauthorized:()=>{e.response.status=401}}),serveHttp:e=>({update:e.request.json(),header:e.request.headers.get(rt)||void 0,end:()=>e.respondWith(at()),respond:t=>e.respondWith(ut(t)),unauthorized:()=>e.respondWith(dt())}),"std/http":e=>{let t;return{update:e.json(),header:e.headers.get(rt)||void 0,end:()=>{t&&t(at())},respond:e=>{t&&t(ut(e))},unauthorized:()=>{t&&t(dt())},handlerReturn:new Promise((e=>{t=e}))}},sveltekit:e=>{let t,{request:n}=e;return{update:Promise.resolve(n.json()),header:n.headers.get(rt)||void 0,end:()=>{t&&t(at())},respond:e=>{t&&t(ut(e))},unauthorized:()=>{t&&t(dt())},handlerReturn:new Promise((e=>{t=e}))}},worktop:(e,t)=>{var n;return{update:Promise.resolve(e.json()),header:null!==(n=e.headers.get(rt))&&void 0!==n?n:void 0,end:()=>t.end(null),respond:e=>t.send(200,e),unauthorized:()=>t.send(401,ot)}}};ye("grammy:error")}}]);